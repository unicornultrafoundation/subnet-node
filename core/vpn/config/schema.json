{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "VPN Configuration",
  "description": "Configuration schema for the VPN service",
  "type": "object",
  "properties": {
    "vpn": {
      "type": "object",
      "description": "VPN service configuration",
      "properties": {
        "enable": {
          "type": "boolean",
          "description": "Enable or disable the VPN service",
          "default": false
        },
        "mtu": {
          "type": "integer",
          "description": "Maximum Transmission Unit (MTU) for the VPN interface",
          "minimum": 576,
          "maximum": 9000,
          "default": 1400
        },
        "virtual_ip": {
          "type": "string",
          "description": "Virtual IP address for this node in the VPN network",
          "pattern": "^\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}$",
          "examples": ["10.0.0.1"]
        },
        "subnet": {
          "type": "integer",
          "description": "Subnet mask for the virtual IP (CIDR notation)",
          "minimum": 0,
          "maximum": 32,
          "default": 8
        },
        "routes": {
          "type": "array",
          "description": "Routes to be added to the routing table",
          "items": {
            "type": "string",
            "pattern": "^\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}/\\d{1,2}$"
          },
          "default": ["10.0.0.0/8"]
        },
        "unallowed_ports": {
          "type": "array",
          "description": "Ports that are not allowed to be used for VPN traffic",
          "items": {
            "type": "string"
          },
          "default": []
        },
        "worker_idle_timeout": {
          "type": "integer",
          "description": "Timeout in seconds after which an idle worker is terminated",
          "minimum": 1,
          "default": 300
        },
        "worker_buffer_size": {
          "type": "integer",
          "description": "Buffer size for worker packet queues",
          "minimum": 1,
          "default": 100
        },
        "max_workers": {
          "type": "integer",
          "description": "Maximum number of worker goroutines",
          "minimum": 1,
          "default": 1000
        },
        "worker_cleanup_interval": {
          "type": "integer",
          "description": "Interval in seconds for cleaning up idle workers",
          "minimum": 1,
          "default": 60
        },

        "min_streams_per_peer": {
          "type": "integer",
          "description": "Minimum number of streams per peer",
          "minimum": 1,
          "default": 3
        },
        "stream_idle_timeout": {
          "type": "integer",
          "description": "Timeout in seconds after which an idle stream is closed",
          "minimum": 1,
          "default": 300
        },
        "cleanup_interval": {
          "type": "integer",
          "description": "Interval in seconds for cleaning up idle streams",
          "minimum": 1,
          "default": 60
        },
        "circuit_breaker_failure_threshold": {
          "type": "integer",
          "description": "Number of failures before the circuit breaker opens",
          "minimum": 1,
          "default": 5
        },
        "circuit_breaker_reset_timeout": {
          "type": "integer",
          "description": "Timeout in seconds before the circuit breaker resets to half-open state",
          "minimum": 1,
          "default": 60
        },
        "circuit_breaker_success_threshold": {
          "type": "integer",
          "description": "Number of successes needed to close the circuit breaker",
          "minimum": 1,
          "default": 2
        },
        "health_check_interval": {
          "type": "integer",
          "description": "Interval in seconds between health checks",
          "minimum": 1,
          "default": 30
        },
        "health_check_timeout": {
          "type": "integer",
          "description": "Timeout in seconds for health check operations",
          "minimum": 1,
          "default": 5
        },
        "max_consecutive_failures": {
          "type": "integer",
          "description": "Maximum number of consecutive health check failures before marking a resource as unhealthy",
          "minimum": 1,
          "default": 3
        },
        "warm_interval": {
          "type": "integer",
          "description": "Interval in seconds for warming up streams",
          "minimum": 1,
          "default": 60
        },
        "retry_max_attempts": {
          "type": "integer",
          "description": "Maximum number of retry attempts",
          "minimum": 1,
          "default": 5
        },
        "retry_initial_interval": {
          "type": "integer",
          "description": "Initial retry interval in seconds",
          "minimum": 1,
          "default": 1
        },
        "retry_max_interval": {
          "type": "integer",
          "description": "Maximum retry interval in seconds",
          "minimum": 1,
          "default": 30
        }
      },
      "required": ["enable"]
    }
  }
}
